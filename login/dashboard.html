<!doctype html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="../dist/output.css" rel="stylesheet">
</head>
<body>
    <div class="flex items-center justify-center h-screen bg-discord-gray flex-col">
      <div class="text-white text-3xl">Welcome to the dashboard, </div>
      <div class="flex items-center mt-4">
        <img class="rounded-full w-12 h-12 mr-3" src="${avatarUrl}" />
        <span class="text-3xl text-white font-semibold">${name}</span>
        <ul class="w-96 text-sm font-medium text-gray-900 bg-white rounded-lg border border-gray-200 dark:bg-gray-700 dark:border-gray-600 dark:text-white mt-6">
          <h3 class="text-xl font-bold ml-3 text-gray-300 uppercase py-2">Guilds:</h3>
          ${guildMarkup}
        </ul>
      </div>
      <a href="logout.html" class="mt-5 text-gray-300">Logout</a>
    </div>

</body>
</html>

<script>
  const session = window.sessionStorage;

  if (!session.getItem('logged_in')) {
    window.location.replace('error.html');
  }

  const userData = JSON.parse(session.getItem('userData'));
  const { discord_id, avatar, name } = userData;
  const avatarUrl = `https://cdn.discordapp.com/avatars/${discord_id}/${avatar}.jpg`;

  const guilds = userData.guilds;
  let guildMarkup = '';

  guilds.forEach((guildData) => {
    guildMarkup += `<li class="py-2 px-4 w-full rounded-t-lg border-b border-gray-200 dark:border-gray-600">${guildData.name}</li>`;
  });

  const avatarImg = document.querySelector('.rounded-full');
  avatarImg.src = avatarUrl;

  const nameSpan = document.querySelector('.font-semibold');
  nameSpan.textContent = name;

  const guildList = document.querySelector('ul');
  guildList.innerHTML = `<h3 class="text-xl font-bold ml-3 text-gray-300 uppercase py-2">Guilds:</h3>${guildMarkup}`;

  const logoutLink = document.querySelector('a');
  logoutLink.addEventListener('click', () => {
    session.removeItem('logged_in');
  });
</script>
